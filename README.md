
# 增强版彩色目录树 (ctr)

这是一个功能强大的 Python 脚本，用于生成彩色的目录结构树。它不仅能像传统的 `tree` 命令一样工作，还集成了高度可定制的过滤和显示规则，特别适合在项目开发中使用。

其核心特性是基于 `.gitignore` 的自动忽略、强制摘要显示以及一个清晰的三层优先级覆盖系统。

## ✨ 功能特性

* **彩色输出**：使用 `colorama` 对目录和文件进行着色，输出清晰美观。
* **层级控制**：通过 `-l` 参数自由控制显示的目录深度。
* **智能忽略**：
  * 自动加载并应用当前目录下的 `.gitignore` 规则。
  * 当 `.gitignore` 不存在时，使用内置的常用忽略规则（如 `__pycache__`, `.git`, `node_modules` 等）。
* **摘要显示**：对于包含大量文件的目录（如 `data`, `logs`），可以强制以“摘要”模式显示，避免信息刷屏。
* **强大的优先级系统**：通过三层优先级规则，您可以精确控制每一个文件和目录的显示状态：
  1. **最高优先级**：命令行的 `-i` 参数，用于临时强制显示并摘要化任何被忽略的项。
  2. **次高优先级**：脚本内硬编码的 `SPECIAL_HANDLING_RULES` 列表，用于定义项目的永久性特殊规则（如“data目录永远可见且摘要显示”）。
  3. **最低优先级**：`.gitignore` 和内置忽略规则的组合。

## 🚀 安装与设置

为了在系统的任何路径下都能方便地使用 `ctr` 命令，请遵循以下步骤：

### 1. 先决条件

确保您的系统中已经安装了 Python 3 和 `colorama` 库。

```bash
pip install colorama
```

### 2. 放置文件

将 `tree.py` 和 `ctr.bat` 这两个文件放置在同一个目录下，并将这个目录添加到系统的**环境变量 `PATH`** 中。

例如，您可以创建一个 `C:\bin` 目录，将文件放入其中，然后将 `C:\bin` 添加到 `PATH`。

**`tree.py`**

**`ctr.bat`**

### 3. (可选) 为 Git Bash 设置别名

如果您经常使用 Git Bash，可以为其设置一个别名，以获得更好的使用体验。

```bash
# 将别名命令添加到你的 bash 配置文件中
echo "alias ctr='ctr.bat'" >> ~/.bashrc

# 使配置立即生效
source ~/.bashrc
```

## 🛠️ 使用方法

### 基本命令

```bash
ctr [path] [options]
```

* `path`：要显示的目录路径。如果省略，默认为当前工作目录。

### 命令行选项

| 参数                  | 说明                                                                                                     | 默认值    |
| --------------------- | -------------------------------------------------------------------------------------------------------- | --------- |
| `-l`, `--level`   | 显示的目录层级深度。                                                                                     | `5`     |
| `-a`, `--all`     | 显示所有文件。**注意**：此规则会被“强制摘要”规则覆盖。                                           | `False` |
| `-i`, `--include` | **(最高优先级)** 强制包含某个模式，使其可见并进入摘要模式。可多次使用，例如 `-i .venv -i dist`。 | `[]`    |

## ⚙️ 配置与过滤规则优先级

脚本的过滤行为由一个清晰的三级优先级系统决定：

### 🥇 优先级 1：`--include` 参数 (最高)

这是最高级的规则，用于在命令行上进行**临时覆盖**。

* 任何匹配 `-i` 参数模式的项都将**强制可见**。
* 同时，该项及其所有子目录都将**强制进入摘要模式**。
* 它会覆盖下面的所有规则。例如，即使 `output` 在特殊规则中被设为隐藏，`ctr -i output` 依然可以显示它。

### 🥈 优先级 2：`SPECIAL_HANDLING_RULES` (次高)

这是在 `tree.py` 脚本内部定义的**项目级永久规则**。它是一个三元组列表，用于定义对特定文件夹的特殊处理。

```python
# 格式: (模式, 可见性, 强制摘要)
SPECIAL_HANDLING_RULES = [
    # ('data', True, True) -> 'data' 文件夹总是可见，且总是摘要显示
    ('data', True, True),
    ('dataset', True, True),
    # ('output', False, False) -> 'output' 文件夹总是被隐藏
    ('output', False, False),
]
```

* **可见性 (bool)**: `True` 表示可见，`False` 表示隐藏。
* **强制摘要 (bool)**: `True` 表示该目录及其子目录总是以摘要模式显示，无视 `-a` 参数。

### 🥉 优先级 3：`.gitignore` 和内置规则 (最低)

如果一个项目没有被以上任何规则处理，脚本会最后检查这个忽略列表。

* 脚本会自动加载项目根目录下的 `.gitignore` 文件。
* `.gitignore` 的规则会和脚本内置的 `BUILTIN_IGNORE_PATTERNS` 列表（包含 `**/__pycache__`, `.git` 等）合并，共同生效。

## 💡 使用示例

1. **基本使用**：

   * 显示当前目录的结构，自动忽略 `.git` 等，并对 `data` 目录进行摘要。

   ```bash
   ctr
   ```
2. **指定路径和深度**：

   * 显示上级目录 `../my-project` 的结构，最多显示3层。

   ```bash
   ctr ../my-project -l 3
   ```
3. **显示所有文件（但尊重摘要规则）**：

   * `-a` 会显示所有未被特殊规则处理的文件。但 `data` 目录因为在 `SPECIAL_HANDLING_RULES` 中被设为强制摘要，所以它**仍然会以摘要模式显示**。

   ```bash
   ctr -a
   ```
4. **临时查看被忽略的目录**：

   * `.venv` 目录通常被内置规则忽略。使用 `-i` 可以临时查看它的结构（并以摘要模式显示）。

   ```bash
   ctr -i .venv
   ```
5. **组合使用**：

   * 扫描 `D:\work` 目录，显示4层，并同时强制显示 `node_modules` 和 `dist` 两个被忽略的文件夹。

   ```bash
   ctr D:\work -l 4 -i node_modules -i dist
   ```
